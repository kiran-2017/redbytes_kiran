<?xml version="1.0" encoding="UTF-8" ?>
<odoo>

  <!-- Inherit external Layout Header -->
  <template id="external_layout_header_inherited">
      <div class="header">
          <div class="row">

                <div class="text-center col-xs-12" style="margin-top:2px;">
                <!-- <h1>DELIVERY CHALLAN</h1> -->
                <span class="text-right"><h5>[ORIGINAL FOR RECIPIENT]</h5></span>
              </div>

          </div>

      </div>
  </template>

<!-- Inherit external Layout -->
  <template id="external_layout">
      <!-- Multicompany -->
      <t t-if="not o and doc">
          <t t-set="o" t-value="doc"/>
      </t>
      <t t-if="o and 'company_id' in o">
          <t t-set="company" t-value="o.company_id"></t>
      </t>
      <t t-if="not o or not 'company_id' in o">
          <t t-set="company" t-value="res_company"></t>
      </t>
      <!-- Added new header here-->
      <t t-call="IV_reports.external_layout_header_inherited" />
      <t t-raw="0" />
      <!-- <t t-call="report.external_layout_footer" /> -->
  </template>

    <!--Inherited delivery slip template  -->
    <template id="report_delivery_document_inherited">
        <t t-call="report.html_container">
            <t t-call="IV_reports.external_layout">
                <t t-set="o" t-value="o.with_context({'lang':o.partner_id.lang})" />
                <div class="page">
                  <div>
                      <!--Add css here -->
                      <style>
                        .tr_formating{
                            border: 2px solid #000000;
                        }
                        .td_formating{
                            border: 1px solid #000000;
                        }
                      </style>
                  </div>



                  <table class="table table-condensed mt48 page_bar" width="100%" style="border: 2px solid #000000; margin-top:2000px;">
                      <tr>
                        <td class="td_formating" colspan="2">
                          <center><h1>DELIVERY CHALLAN</h1></center>
                        </td>
                      </tr>
                      <tr>
                        <td width="40%" class="td_formating">
                          <div class="col-xs-3">
                              <img t-if="o.company_id.logo" t-att-src="'data:image/png;base64,%s' % o.company_id.logo" style="max-height: 50px;"/>
                          </div>
                          <div class="col-xs-10 text-center" t-field="o.company_id.rml_header1"/>
                        </td>

                        <td width="60%" style="padding:0px !important;" class="td_formating">
                            <table class="table-condensed" width="100%">
                                <tr>
                                      <td class="td_formating" width="50%">
                                        <strong>Challan No. :</strong>
                                        <span t-if="o.name" t-field="o.name"/>
                                      </td>

                                      <td class="td_formating" width="50%" style="padding-bottom:30px !important;">
                                        <strong>Challan Date :</strong>
                                         <t t-if="o.state == 'done'">
                                           <span t-if="o.date_done" t-esc="o.date_converted(o.date_done)"/>
                                         </t>
                                         <t t-if="o.state != 'done'">
                                              <span t-if="o.min_date" t-esc="o.date_converted(o.min_date)"/>
                                         </t>
                                      </td>
                                </tr>

                                <tr>
                                      <td class="td_formating" width="50%">
                                        <strong>Order No. :</strong>
                                        <span t-if="o.origin" t-esc="o.get_cust_ref(o.origin)"/>
                                      </td>

                                      <td class="td_formating" width="50%">
                                        <t t-if="o.picking_type_id.code=='outgoing'">
                                          <t t-set="so" t-value="o.get_so_data(o.origin)" />
                                          <strong>Order Date :</strong>
                                            <span t-if="so.date_order" t-esc="o.date_converted(so.date_order)"/>
                                        </t>
                                      </td>
                                </tr>

                            </table>
                          </td>
                        </tr>

                        <tr>
                          <td class="td_formating">
                            <!-- -->
                            <strong><span t-field="o.company_id"/></strong><br/>
                            <span t-if="o.company_id.street" t-field="o.company_id.street"/>
                            <span t-if="o.company_id.street2" t-field="o.company_id.street2"/><br/>
                            <span t-if="o.company_id.city" t-field="o.company_id.city"/>-
                            <span t-if="o.company_id.state_id" t-field="o.company_id.state_id"/><br/>
                            <!-- <span t-if="o.company_id.zip" t-field="o.company_id.zip"/><br/> -->
                            <span>Telephone:</span> <span t-if="o.company_id.phone" t-field="o.company_id.phone"/><br/>
                            Email: <span t-if="o.company_id.email" t-field="o.company_id.email"/><br/>
                            GSTIN : <span t-if="o.company_id.vat" t-field="o.company_id.vat"/><br/>
                          </td>
                          <td class="td_formating" style="padding:0px !important;">
                            <!--Show delivery address here -->
                            <strong><span>Consignee (Shipped To) : </span></strong><br/>
                            <strong><span t-if="o.partner_id" t-field="o.partner_id"/></strong><br/>
                            <span t-if="o.partner_id.street" t-field="o.partner_id.street"/><br/>
                            <span t-if="o.partner_id.street2" t-field="o.partner_id.street2"/>
                            <span t-if="o.partner_id.city" t-field="o.partner_id.city"/>-
                            <span t-if="o.partner_id.state_id" t-field="o.partner_id.state_id"/><br/>
                            Place of Supply/State code: <span t-if="o.partner_id.place_of_supply" t-field="o.partner_id.place_of_supply"/><br/>
                            GSTIN : <span t-if="o.partner_id.partner_gstin" t-field="o.partner_id.partner_gstin"/><br/>
                            <br/><br/><br/>
                          </td>
                        </tr>


                        <tr>
                          <td width="50%" colspan="2" style="padding:0px !important;" class="td_formating">

                              <table class="table-condensed" t-if="not o.pack_operation_ids" width="100%">
                                  <tr>
                                      <th class="td_formating"><strong>Sr.No.</strong></th>
                                      <th class="td_formating"><strong>Description</strong></th>
                                      <th class="td_formating"><strong>Weight</strong></th>
                                      <th class="td_formating"><strong>UOM</strong></th>
                                      <th class="td_formating"><strong>HSN Code</strong></th>
                                      <th t-if="any([pack_operation.state == 'done' for pack_operation in o.pack_operation_ids])" class="text-right td_formating">
                                          <strong>Qty</strong>
                                      </th>
                                  </tr>
                                  <tbody>
                                    <t t-set="i" t-value="1"/>
                                    <tr t-foreach="o.move_lines" t-as="move">
                                        <td class="td_formating">
                                          <span t-esc="i">
                                            <t t-set="i" t-value="i+1"/>
                                          </span>
                                        </td>

                                        <td class="td_formating"><span t-field="move.product_id"/></td>
                                        <td t-if="((move.product_id.is_weight_applicable) and (move.product_id.weight>0))">
                                          <span t-field="move.product_id.weight"/>
                                        </td>
                                        <td class="td_formating">
                                            <span t-field="move.product_uom"/>
                                        </td>
                                        <td class="td_formating">
                                            <span t-field="move.product_id.product_hsn_code"/>
                                        </td>
                                        <!-- <td class="td_formating">
                                            <span t-field="move.ordered_qty"/>
                                        </td> -->
                                        <td class="td_formating">
                                            <span t-if="pack_operation" t-field="pack_operation.qty_done"/>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                            <t t-set="backorder" t-value="False"/>

                              <!-- Print DC lines-->
                              <table class="table-condensed" t-if="o.pack_operation_ids" width="100%">
                                  <t t-set="has_serial_number" t-value="o.pack_operation_ids.filtered('pack_lot_ids')" groups="stock.group_production_lot"/>
                                    <tr>
                                        <th class="td_formating"><strong>Sr.No.</strong></th>
                                        <th class="td_formating"><strong>Description</strong></th>
                                        <th class="td_formating"><strong>Weight</strong></th>
                                        <th class="td_formating"><strong>UOM</strong></th>
                                        <th class="td_formating"><strong>HSN Code</strong></th>
                                        <th t-if="any([pack_operation.state == 'done' for pack_operation in o.pack_operation_ids])" class="text-right td_formating">
                                                <strong>Qty</strong>
                                        </th>
                                    </tr>

                                    <tbody>
                                        <t t-set="i" t-value="1" />
                                        <tr t-foreach="o.pack_operation_ids" t-as="pack_operation">
                                          <td class="td_formating">
                                            <!-- Logic for serial number printing on DC-->
                                              <span t-esc="i"/>
                                              <t t-set="i" t-value="i+1"/>
                                          </td>
                                          <t t-set="sale_order_line_data" t-value="o.get_sale_order_line_data(o.origin, pack_operation.product_id)"/>
                                          <td class="td_formating">
                                              <span t-field="pack_operation.product_id"/>
                                              <!-- Print vore, valve , valve operation, pn, case file no, seril no, etc-->
                                              <t t-if="o.picking_type_id.code=='outgoing' and o.origin">
                                                  <span t-if="sale_order_line_data"><br/></span>
                                                  <!-- <span t-if="sale_order_line_data">For:</span><span t-if="sale_order_line_data" t-field="sale_order_line_data.valve"/><span t-if="sale_order_line_data">,</span>
                                                  <span t-if="sale_order_line_data" t-field="sale_order_line_data.valve_operation"/><span t-if="sale_order_line_data">,</span>
                                                  PN:<span t-if="sale_order_line_data" t-field="sale_order_line_data.pn"/><br/>
                                                  Case File: <span  t-if="sale_order_line_data" t-field="sale_order_line_data.case_file_number"/><br/>
                                                  Bore: <span t-if="sale_order_line_data" t-field="sale_order_line_data.bore"/>
                                                  <span t-if="sale_order_line_data"> mm</span> -->
                                              </t>
                                              <br/>
                                              SR. NO(s) :
                                              <t t-foreach="pack_operation.pack_lot_ids" t-as="packlot">
                                                  <span t-field="packlot.lot_id"/>
                                                  <t t-if="not packlot.lot_id">
                                                      <span t-field="packlot.lot_name"/>
                                                  </t>
                                              </t>
                                              <t t-if="not pack_operation.product_id and pack_operation.package_id">
                                                  <span  t-field="pack_operation.package_id"/>
                                              </t>
                                          </td>
                                          <!-- Add weight fields here-->
                                          <td class="td_formating">
                                              <t t-if="((pack_operation.product_id.is_weight_applicable) and (pack_operation.product_id.weight>0))">
                                                  <span  t-if="(pack_operation.product_id.weight*pack_operation.qty_done)>0" t-esc="(pack_operation.product_id.weight*pack_operation.qty_done)"/>
                                              </t>
                                          </td>
                                          <td class="td_formating">
                                            <span t-if="pack_operation" t-field="pack_operation.product_uom_id"/>
                                          </td>

                                          <td class="td_formating">
                                            <span t-field="pack_operation.product_id.product_hsn_code"/>
                                          </td>

                                          <!-- <td class="text-center">
                                              <span t-if="pack_operation.package_id">:</span>
                                              <span t-field="pack_operation.package_id"/>
                                              <span t-field="pack_operation.ordered_qty"/>
                                              <span t-field="pack_operation.product_uom_id"/>
                                          </td>
                                           -->

                                          <td class="text-right td_formating" t-if="pack_operation.state == 'done'">
                                            <t t-if="pack_operation.ordered_qty != pack_operation.qty_done">
                                                <t t-set="backorder" t-value="True"/>
                                            </t>
                                            <span t-if="pack_operation" t-field="pack_operation.qty_done"/>
                                         </td>

                                        </tr>
                                        <tr t-if="sum(l.qty_done for l in o.pack_operation_ids)>0.0">
                                          <td class="td_formating"></td>
                                          <td class="td_formating text-center" >
                                            <strong>Total</strong>
                                          </td>
                                          <td class="text-right td_formating" t-if="o.state == 'done'" colspan="8">
                                              <strong><t t-if="(l.qty_done for l in o.pack_operation_ids)" t-esc="%.0f'%sum(l.qty_done for l in o.pack_operation_ids)"/></strong>
                                          </td>
                                        </tr>
                                    </tbody>
                                  </table>
                                </td>
                            </tr>

                            <tr>
                              <td class="td_formating" colspan="6">
                                <table width="100%" style="border: 0px !important;">
                                  <t t-set="order_data" t-value="o.get_orders(o.origin)" />
                                  <t t-set="so" t-value="o.get_so_data(o.origin)" />
                                  <tr>
                                    <td>
                                      Terms of Delivery : <span t-esc="o.get_delivert_term(o.origin)"/> <br/>
                                      Vehicle Registration No : <span t-esc="o.vehical_registration_no"/> <br/>
                                      LR No : <span t-esc="o.lr_no"/> <br/>
                                      Transporter : <span t-esc="o.transporter_name_id.name"/><br/>
                                      E-Way Bill No :  <span t-esc="o.eway_bill_no"/><br/>
                                    </td>
                                    <td>
                                      <t t-if="o.picking_type_id.code=='outgoing'">
                                        Insurance Terms : <span t-if="so" t-esc="so.insurance"/><br/>
                                      </t>
                                      Freight Terms : <span t-esc="o.basis_of_freight"/><br/>
                                      Payment Terms : <span t-esc="order_data.payment_term_id.name"/><br/>
                                      <t t-if="o.picking_type_id.code=='outgoing'">
                                        Mode of delivery : <span t-if="so" t-esc="so.delivery_instructions.name"/><br/>
                                        Mode of shipment : <span t-if="so" t-esc="so.mode_of_shipment.name"/><br/>
                                      </t>
                                  </td>
                                  <td style="text-align:right;" width="30%">
                                      <span>For</span> <strong><span t-if="o.company_id" t-esc="o.company_id.name"/></strong>
                                      <br/>
                                      <br/>
                                      <br/><br/>
                                      <span style="text-align:right;">  Authorised Signatory</span>
                                  </td>

                                  </tr>
                                </table>
                              </td>
                            </tr>

                    </table>

              </div>
            </t>
        </t>
    </template>

    <!-- Call template from here -->
    <template id="report_deliveryslip_inherited">
        <t t-foreach="docs" t-as="o">
            <t t-call="IV_reports.report_delivery_document_inherited" t-lang="o.partner_id.lang"/>
        </t>
    </template>

</odoo>
